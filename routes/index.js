var express = require('express');var router = express.Router();var Datastore = require('nedb');var responder = require('../httpRespond');var db = {};// Connect to an NeDB databasedb.movies = new Datastore({filename: 'db/movies', autoload: true});router.use(function (req, res, next){    res.type('application/json');    res.locals.respond = responder.setup(res);    next();});// Routesrouter.get('/', function(req, res, next) {  res.send("Api working!");});router.get('/movies', function (req, res){    db.movies.find({}, res.locals.respond);});router.post('/movies', function(req, res){    db.movies.insert({ title: req.body.title }, res.locals.respond);});router.get('/movies/:id', function (req, res) {    db.movies.findOne({ _id: req.params.id }, res.locals.respond);});router.put('/movies/:id', function (req, res){    db.movies.update({ _id: req.params.id }, req.body, function (err, num) {        res.locals.respond(err, { success: num + " records updated" });    });});router.delete('/movies/:id', function(req, res){    db.movies.remove({ _id: req.params.id }, res.locals.respond);});router.post('/movies/:id', function (req, res) {    switch (req.body.action) {        case "view":            db.movies.findOne({ _id: req.params.id }, res.locals.respond);            break;        case "rate":            db.movies.update({ _id: req.params.id }, { $set: { rating: req.body.rating } }, function (err, num) {                res.locals.respond(err, { success: num + " records updated" });            });            break;    }});module.exports = router;